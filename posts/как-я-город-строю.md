---
title: как я город строю
description: хотел сделать игру про город. Пост о том, как я пытался процедурно построить этот город.
date: 2015-11-04 21:41:00
tags:
layout: layouts/post.njk
---
![процедурно построенная сеть дорог](/img/как-я-город-строю/процедурно_построенная_городская_сеть_1.png)
![ещё одна процедурно построенная сеть дорог](/img/как-я-город-строю/процедурно_построенная_городская_сеть_2.png)

Задумал я сделать игру с процедурно-генерируемым миром.
И не хочется это делать абы как, а хочется сделать хорошо. Хочется чтобы город не выглядел реалистично, а был таковым.

К сожалению где-то мне не хватает умений, где-то знаний.

Для начала я загуглил. Возможно кто-то этим уже занимался. Нашел интересную [статью](https://vc.ru/p/unity-world) на vc.ru. Также в конференции ruhaxe мне скинули статью о том как introversion software делали когда-то игру (но не доделали) и тем не менее там город генерировался процедурно: [ссылка на один из постов из серии](http://forums.introversion.co.uk/viewtopic.php?t=40530)
Это ссылка на один из постов из серии. Самый интересный для меня- по генерации города.
Также еще пара занятных ссылок:
[как нарисовать город](http://www.fantasticmaps.com/2013/03/how-to-design-a-town/)
Занятное [видео](https://www.youtube.com/watch?v=-d2-PtK4F6Y) по тому, как можно сделать скринсейвер. Но критику по поводу тайлового города я написал ниже.

Сам я решил следовать пути introversion.

Для начала получил шум перлина
![шум перлина](/img/как-я-город-строю/шум_перлина.png)

Затем начал его анализировать. Наиболее насыщенные черным точки будут у нас якорями для людей. Площади, торговые центры, транспортные узлы.
![анализ шума](/img/как-я-город-строю/анализ_шума.png)

И тут же вдогонку то, как я начал их фильтровать
![отфильтрованный шум](/img/как-я-город-строю/отфильтрованный_шум.png)
Это все было не так сложно.
Теперь у меня появилась задача их соединить. Сразу скажу что я использовал графы.
Из меня очень плохой математик и я как мог пытался найти какие-либо более простые решения, но в итоге я понял что ничего проще математика не придумала, а волшебной палочки у меня увы нет.

Алгоритм по-своей сути очень простой. Начать стоит с того, что каждая точка, теперь у меня отдельная нода в еще не построенном графе.
Сначала я беру точку, которая ближе всего к центру. И потом она просматривает все точки по-удаленности от нее.
Если с этой точкой она не соединена никак, то к ней прокладывается путь. Путь прокладывается не напрямую, а берется ближняя соединенная с этой центральной точкой.
В итоге мы имеем это:
![отфильтрованные точки соединённые графами](/img/как-я-город-строю/отфильтрованные_точки_соединённые_графами.png)
![отфильтрованные точки соединённые графами 2](/img/как-я-город-строю/отфильтрованные_точки_соединённые_графами_1.png)
![отфильтрованные точки соединённые графами 3](/img/как-я-город-строю/отфильтрованные_точки_соединённые_графами_2.png)
Как мне кажется, тут уже можно увидеть некие очертания города.
Также мне кажется, что некоторые точки было бы проще соединить напрямую.
Я пытался сделать алгоритм, который бы сравнивал путь по уже соединенной дороге, и путь напрямую. Я целый день пытался найти соотношение между стоимостью пути по графу и расстоянием, но не смог. Как я писал выше, из меня плохой математик.

Но в принципе это не так фатально, потому что это лишь большие дороги, эдакие городские артерии. И в городе они не всегда располагаются там где надо, и вообще, их строительство скорее хаотично.
Так что я сбросил с себя ответственность за удобные городские развязки и решил попробовать делать второстепенные дороги.
![первостепенные_и_второстепенные_дороги](/img/как-я-город-строю/первостепенные_и_второстепенные_дороги.png)
![первостепенные_и_второстепенные_дороги 2](/img/как-я-город-строю/первостепенные_и_второстепенные_дороги_1.png)
Как мне кажется это уже что-то с чем-то.
Но теперь я ломаю голову над тем как сделать кварталы.
Надеюсь что я найду решение.

Конечно это все больше похоже на героическое преодоление собственноручно созданных проблем.
Также мне виделся довольно простой способ просто создать тайловую карту и раскидать по ней рандомно те или иные объекты. Но тогда город получался бы идеальным. Дороги строго перпендикулярные друг-другу и прочие несовершенства тайлов.
Хотя может к этому я еще и вернусь.
