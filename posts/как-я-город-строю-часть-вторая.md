---
title: как я город строю, часть вторая
description: хотел сделать игру про город. Пост о том, как я пытался процедурно построить этот город.
date: 2015-11-09 19:06:00
tags:
layout: layouts/post.njk
---
Да, хоть я не особо много делаю, но все-равно результатами поделиться хочется. Надоело донимать людей в личку со своими результатами. Итак, картиночка для затравки
![дома и переулки в пиксель арте](/img/как-я-город-строю-часть-вторая/пиксельный_микрорайон.png)
И сразу можно заметить большое изменение в том, что я решил сделать город тайловым. Изначально я даже фантазировал о том чтобы сделать город не привязанным к клеточкам. В качестве маленького признания могу сказать что ориентировался на 2гис. Но потом решил оставить эту идею и сделать город тайловым. Так я получаю больше контроля за его элементами.

Теперь снова к алгоритму генерации города.

В тайлах он у меня выглядел примерно так
![дома и переулки в пиксель арте](/img/как-я-город-строю-часть-вторая/сломанный_тайловый_город.png)
Не совсем красиво, и совсем не то что я хотел видеть бы.

Алгоритм прокладки дорог сломался. Пришлось чинить его. И в итоге получилось вот это
![дома и переулки в пиксель арте](/img/как-я-город-строю-часть-вторая/городские_артерии_и_второстепенные_дороги.png)
![дома и переулки в пиксель арте](/img/как-я-город-строю-часть-вторая/городские_артерии_и_второстепенные_дороги_2.png)
Но это городские артерии и второстепенные дороги. А где же дороги которые прокладываются между кварталами? Собственно говоря кварталы и составляют основу города. Как сказал один мой знакомый, это больше похоже на поселок городского типа.

Как я писал в прошлом посте, у меня не получилось проложить эти маленькие улочки. Не нашел подходящего алгоритма, а мой собственный работал непредсказуемо.

Ну что же, я решил подойти с другой стороны. Найти собственно говоря эти кварталы, и потом уже пусть между ними проходят дороги.

Сказано-сделано. У меня уже в коде было ранжирование клеток по их условной привлекательности. Осталось его отобразить.
![клетки отранжированные по привлекательности](/img/как-я-город-строю-часть-вторая/клетки_отранжированные_по_привлекательности.png)
![клетки отранжированные по привлекательности 2](/img/как-я-город-строю-часть-вторая/клетки_отранжированные_по_привлекательности_2.png)
Условно говоря красные это клетки, в которых должна быть дорогая земля.

Алые это где менее дорогая. Белые это просто условно поля и пустота. Они-то мне и интересны. Их надо разделить на кварталы и определить их назначение. Жилой квартал, заводской, возможно коммерческий.

Начал делить и получился баг.
![всё поле заполняется клетками](/img/как-я-город-строю-часть-вторая/всё_поле_занятое_клетками.png)

Заполнялось все поле. Отдохнув и посмотрев еще раз на код я смог это исправить.
![исправленное и поделённое по назначению поле](/img/как-я-город-строю-часть-вторая/исправленное_и_поделённое_по_назначению_поле.png)
Уже как мне кажется лучше.
Чем темнее цвет, тем дороже земля в квартале. 

Тут я думаю можно рассказать вкратце как я делал эти условные кварталы.
Кварталы делаются очень простой, рекурсивной заливкой.
Хоть я и недолюбливаю хабр, но там нашлось хорошо расписанное решение. Я просто прохожусь по всем тайлам, и если он еще не использован в другом квартале и не является дорогой, то я закрашиваю его.

Теперь надо решить задачу как эти кварталы заполнять максимально правильно. Эту задачу только предстоит решить.
Зачем это делать?
Город состоит из восьмиклеточных тайлов. В тайл 8х8 трудно вставить что-то. Поэтому я решил делать здания состоящие из нескольких таких тайлов.
![тайлы домиков](/img/как-я-город-строю-часть-вторая/тайлы_домиков.png)
Насколько я понимаю, задача представляет собой заполнить поле тетрамино. Да, по-сути мне надо сделать что-то вроде саморешающегося тетриса.
Пока я только подбираюсь к этой задаче, смотрю возможные решения. Почитать по этой теме можно [на википедии](https://href.li/?https://ru.wikipedia.org/wiki/Тетрамино).
И вот вроде как решение, [тоже на вики](https://href.li/?https://en.wikipedia.org/wiki/Knuth%27s_Algorithm_X). Но надеюсь я смогу найти более простое и надеюсь что реализованное решение. В лоб раскидывать тайлы не хочется. Хотя может быть тоже вариант.

Также есть и проблемы. При этом тянущиеся еще с самого начала работы. Например порой все получаемое мной поле является насыщенным. В итоге мы имеем что-то вроде такого.
![поле целиком заполнено дорогими участками](/img/как-я-город-строю-часть-вторая/поле_целиком_заполнено_дорогими_участками.png)
Проблему с дорогами в квартале я тоже еще особо не решил.

Ну и также стоит отметить что чем я больше думаю о построении городов, тем больше я понимаю какая это насыщенная и сложная структура. То что строю я есть город по-форме, но не по-содержанию, увы. Как мне справедливо заметили, города развиваются итеративно, с течением времени. А не разом как делаю я. Плюс также стоит отметить что существует множество разных городов. Не только такой как делаю я. Есть города кольцеобразные (Москва), есть осевые (Париж). И даже та структура от которой я убегал- сетевые (Нью-Йорк).
Но в принципе для моей игры будет достаточно и того что делаю я. Описать же все города мне жизни не хватит. Но может быть найдутся люди которым это будет интересно и будет интересно попробовать построить свои.


Такие вот дела. Спасибо за внимание.
